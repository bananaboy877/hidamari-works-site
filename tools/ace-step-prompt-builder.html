<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ACE-Step Prompt Builder</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg-body: #1a1714;
  --bg-primary: #211e1a;
  --bg-card: #2a2621;
  --bg-chip: #332e28;
  --bg-chip-hover: #3d3730;
  --bg-chip-on: rgba(217, 119, 70, 0.14);
  --border: #3a3530;
  --border-active: #d97746;
  --text-primary: #ede7dd;
  --text-secondary: #b5aa9a;
  --text-muted: #857a6c;
  --accent: #d97746;
  --accent-glow: rgba(217, 119, 70, 0.25);
  --accent-blue: #7ca2e0;
  --accent-orange: #d97746;
  --accent-pink: #d98fa3;
  --accent-purple: #a78bfa;
  --accent-red: #d9645a;
  --accent-yellow: #d4b94e;
  --output-bg: #15120f;
  --shadow: 0 2px 12px rgba(0,0,0,0.4);
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Noto Sans JP', sans-serif;
  background: var(--bg-body);
  color: var(--text-primary);
  font-size: 16px;
  line-height: 1.7;
  font-weight: 400;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
}
.app { max-width: 960px; margin: 0 auto; padding: 32px 20px 200px; }

/* Header */
.header { text-align: center; padding: 32px 0 28px; margin-bottom: 24px; }
.header h1 {
  font-size: 30px; font-weight: 900;
  background: linear-gradient(135deg, var(--accent), var(--accent-blue));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  margin-bottom: 8px;
}
.header p { color: var(--text-secondary); font-size: 15px; }

/* Category Section */
.category {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 12px;
  overflow: hidden;
}
.category-header {
  display: flex; align-items: center; gap: 10px;
  padding: 16px 20px;
  cursor: pointer;
  user-select: none;
  transition: background 0.15s;
}
.category-header:hover { background: rgba(255,255,255,0.03); }
.category-icon {
  font-size: 20px; width: 30px; text-align: center; flex-shrink: 0;
}
.category-title {
  font-size: 16px; font-weight: 700; flex: 1;
}
.category-count {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px; font-weight: 600;
  background: var(--bg-chip);
  color: var(--text-muted);
  padding: 2px 9px;
  border-radius: 10px;
  min-width: 26px; text-align: center;
  transition: all 0.2s;
}
.category-count.has-active {
  background: var(--bg-chip-on);
  color: var(--accent);
}
.category-chevron {
  color: var(--text-muted);
  font-size: 13px;
  transition: transform 0.2s;
}
.category.open .category-chevron { transform: rotate(180deg); }
.category-body {
  display: none;
  padding: 4px 20px 18px;
}
.category.open .category-body { display: block; }

/* Subcategory */
.subcategory-label {
  font-size: 12px; font-weight: 600; color: var(--text-muted);
  text-transform: uppercase; letter-spacing: 0.06em;
  margin: 12px 0 8px; padding-left: 2px;
}

/* Chips */
.chips { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 6px; }
.chip {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 7px 14px;
  background: var(--bg-chip);
  border: 1px solid transparent;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 500;
  color: var(--text-secondary);
  cursor: pointer;
  user-select: none;
  transition: all 0.15s;
  white-space: nowrap;
}
.chip:hover {
  background: var(--bg-chip-hover);
  color: var(--text-primary);
}
.chip.on {
  background: var(--bg-chip-on);
  border-color: var(--border-active);
  color: var(--accent);
}
.chip .jp {
  font-size: 11px;
  color: var(--text-muted);
  margin-left: 2px;
}
.chip.on .jp { color: rgba(217, 119, 70, 0.55); }

/* Custom input */
.custom-input-row {
  display: flex; gap: 8px; margin-top: 10px;
}
.custom-input {
  flex: 1;
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 9px 14px;
  font-size: 14px;
  color: var(--text-primary);
  font-family: 'Noto Sans JP', sans-serif;
  outline: none;
}
.custom-input:focus { border-color: var(--accent); }
.custom-input::placeholder { color: var(--text-muted); }
.custom-add-btn {
  padding: 9px 18px;
  background: var(--accent);
  color: var(--bg-body);
  border: none;
  border-radius: 8px;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
  font-family: 'Noto Sans JP', sans-serif;
  white-space: nowrap;
}
.custom-add-btn:hover { opacity: 0.85; }

/* Output Panel (sticky bottom) */
.output-panel {
  position: fixed;
  bottom: 0; left: 0; right: 0;
  background: var(--output-bg);
  border-top: 1px solid var(--border);
  padding: 16px 20px;
  z-index: 100;
  backdrop-filter: blur(12px);
  background: rgba(21, 18, 15, 0.95);
}
.output-inner {
  max-width: 960px; margin: 0 auto;
}
.output-header {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 8px;
}
.output-label {
  font-size: 12px; font-weight: 700; color: var(--text-muted);
  text-transform: uppercase; letter-spacing: 0.08em;
}
.output-actions { display: flex; gap: 8px; }
.btn-small {
  padding: 6px 14px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  border: 1px solid var(--border);
  background: var(--bg-chip);
  color: var(--text-secondary);
  font-family: 'Noto Sans JP', sans-serif;
  transition: all 0.15s;
}
.btn-small:hover { border-color: var(--accent); color: var(--text-primary); }
.btn-copy {
  background: var(--accent);
  color: var(--bg-body);
  border-color: var(--accent);
}
.btn-copy:hover { opacity: 0.85; }
.output-text {
  font-family: 'JetBrains Mono', monospace;
  font-size: 14px;
  line-height: 1.7;
  color: var(--accent);
  background: var(--bg-primary);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 16px;
  min-height: 44px;
  max-height: 80px;
  overflow-y: auto;
  word-break: break-all;
}
.output-text.empty {
  color: var(--text-muted);
  font-family: 'Noto Sans JP', sans-serif;
  font-style: italic;
}
.output-word-count {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 4px;
  text-align: right;
}

/* Toast */
.toast {
  position: fixed; top: 20px; right: 20px;
  background: var(--accent);
  color: #fff;
  padding: 12px 22px;
  border-radius: 8px;
  font-size: 14px; font-weight: 600;
  z-index: 200;
  opacity: 0;
  transform: translateY(-10px);
  transition: all 0.3s;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateY(0); }

/* Search */
.search-bar {
  position: relative;
  margin-bottom: 16px;
}
.search-input {
  width: 100%;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 12px 16px 12px 40px;
  font-size: 15px;
  color: var(--text-primary);
  font-family: 'Noto Sans JP', sans-serif;
  outline: none;
}
.search-input:focus { border-color: var(--accent); }
.search-input::placeholder { color: var(--text-muted); }
.search-icon {
  position: absolute; left: 14px; top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
  font-size: 15px;
}

@media (max-width: 640px) {
  .app { padding: 20px 12px 200px; }
  .chip { font-size: 13px; padding: 6px 12px; }
}
</style>
</head>
<body>

<div class="app" id="app">
  <div class="header">
    <h1>üéµ ACE-Step Prompt Builder</h1>
    <p>„Çø„Ç∞„Çí„Çø„ÉÉ„Éó„Åó„Å¶ON/OFF ‚Üí ‰∏ãÈÉ®„Å´„Éó„É≠„É≥„Éó„Éà„ÅåËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åô</p>
  </div>

  <div class="search-bar">
    <span class="search-icon">üîç</span>
    <input class="search-input" type="text" placeholder="„Çø„Ç∞„ÇíÊ§úÁ¥¢‚Ä¶Ôºà‰æã: piano, battle, warmÔºâ" id="searchInput">
  </div>

  <div id="categories"></div>
</div>

<!-- Output Panel -->
<div class="output-panel">
  <div class="output-inner">
    <div class="output-header">
      <span class="output-label">ÁîüÊàê„Éó„É≠„É≥„Éó„Éà (Caption)</span>
      <div class="output-actions">
        <button class="btn-small" onclick="clearAll()">ÂÖ®Ëß£Èô§</button>
        <button class="btn-small btn-copy" onclick="copyPrompt()">„Ç≥„Éî„Éº</button>
      </div>
    </div>
    <div class="output-text empty" id="outputText">„Çø„Ç∞„ÇíÈÅ∏Êäû„Åô„Çã„Å®„Åì„Åì„Å´„Éó„É≠„É≥„Éó„Éà„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô</div>
    <div class="output-word-count" id="wordCount"></div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">„Ç≥„Éî„Éº„Åó„Åæ„Åó„ÅüÔºÅ</div>

<script>
// ===== DATA =====
const CATEGORIES = [
  {
    id: "base",
    icon: "üéÆ",
    title: "Âü∫Êú¨Ë®≠ÂÆö",
    open: true,
    subcategories: [
      { label: "Âá∫ÂäõÂΩ¢Âºè", tags: [
        { en: "instrumental", jp: "„Ç§„É≥„Çπ„Éà" },
      ]},
      { label: "Áî®ÈÄî", tags: [
        { en: "game music", jp: "„Ç≤„Éº„É†Èü≥Ê•Ω" },
        { en: "background music", jp: "BGM" },
        { en: "film score", jp: "Êò†ÁîªÈü≥Ê•Ω" },
        { en: "soundtrack", jp: "„Çµ„É≥„Éà„É©" },
        { en: "trailer music", jp: "‰∫àÂëäÁ∑®" },
        { en: "loop music", jp: "„É´„Éº„ÉóÊõ≤" },
        { en: "ambient background", jp: "Áí∞Â¢ÉBGM" },
      ]},
    ]
  },
  {
    id: "genre",
    icon: "üé∏",
    title: "„Ç∏„É£„É≥„É´",
    subcategories: [
      { label: "„ÇØ„É©„Ç∑„ÉÉ„ÇØ / „Ç™„Éº„Ç±„Çπ„Éà„É©", tags: [
        { en: "orchestral", jp: "„Ç™„Éº„Ç±„Çπ„Éà„É©" },
        { en: "cinematic orchestral", jp: "Êò†ÁîªÁöÑÁÆ°Âº¶" },
        { en: "chamber music", jp: "ÂÆ§ÂÜÖÊ•Ω" },
        { en: "symphonic", jp: "‰∫§ÈüøÁöÑ" },
        { en: "baroque", jp: "„Éê„É≠„ÉÉ„ÇØ" },
        { en: "classical", jp: "„ÇØ„É©„Ç∑„ÉÉ„ÇØ" },
        { en: "neo-classical", jp: "„Éç„Ç™„ÇØ„É©„Ç∑„Ç´„É´" },
      ]},
      { label: "„É≠„ÉÉ„ÇØ / „É°„Çø„É´", tags: [
        { en: "rock", jp: "„É≠„ÉÉ„ÇØ" },
        { en: "hard rock", jp: "„Éè„Éº„Éâ„É≠„ÉÉ„ÇØ" },
        { en: "alternative rock", jp: "„Ç™„É´„Çø„Éä„ÉÜ„Ç£„Éñ" },
        { en: "progressive rock", jp: "„Éó„É≠„Ç∞„É¨" },
        { en: "punk rock", jp: "„Éë„É≥„ÇØ" },
        { en: "metal", jp: "„É°„Çø„É´" },
        { en: "heavy metal", jp: "„Éò„É¥„Ç£„É°„Çø„É´" },
        { en: "power metal", jp: "„Éë„ÉØ„Éº„É°„Çø„É´" },
      ]},
      { label: "„Ç®„É¨„ÇØ„Éà„É≠„Éã„ÉÉ„ÇØ", tags: [
        { en: "electronic", jp: "„Ç®„É¨„ÇØ„Éà„É≠" },
        { en: "EDM", jp: "EDM" },
        { en: "synthwave", jp: "„Ç∑„É≥„Çª„Ç¶„Çß„Éº„Éñ" },
        { en: "chiptune", jp: "„ÉÅ„ÉÉ„Éó„ÉÅ„É•„Éº„É≥" },
        { en: "ambient", jp: "„Ç¢„É≥„Éì„Ç®„É≥„Éà" },
        { en: "lo-fi", jp: "„É≠„Éº„Éï„Ç°„Ç§" },
        { en: "drum and bass", jp: "„Éâ„É©„É†„É≥„Éô„Éº„Çπ" },
        { en: "house", jp: "„Éè„Ç¶„Çπ" },
        { en: "techno", jp: "„ÉÜ„ÇØ„Éé" },
        { en: "trance", jp: "„Éà„É©„É≥„Çπ" },
        { en: "dubstep", jp: "„ÉÄ„Éñ„Çπ„ÉÜ„ÉÉ„Éó" },
        { en: "electro-acoustic", jp: "ÈõªÂ≠êÈü≥Èüø" },
      ]},
      { label: "„Ç∏„É£„Ç∫ / „Éñ„É´„Éº„Çπ / „ÇΩ„Ç¶„É´", tags: [
        { en: "jazz", jp: "„Ç∏„É£„Ç∫" },
        { en: "smooth jazz", jp: "„Çπ„É†„Éº„Çπ„Ç∏„É£„Ç∫" },
        { en: "jazz fusion", jp: "„Ç∏„É£„Ç∫„Éï„É•„Éº„Ç∏„Éß„É≥" },
        { en: "blues", jp: "„Éñ„É´„Éº„Çπ" },
        { en: "soul", jp: "„ÇΩ„Ç¶„É´" },
        { en: "neo-soul", jp: "„Éç„Ç™„ÇΩ„Ç¶„É´" },
        { en: "funk", jp: "„Éï„Ç°„É≥„ÇØ" },
        { en: "R&B", jp: "R&B" },
      ]},
      { label: "„Éù„ÉÉ„Éó / „Éï„Ç©„Éº„ÇØ", tags: [
        { en: "pop", jp: "„Éù„ÉÉ„Éó" },
        { en: "J-pop", jp: "J„Éù„ÉÉ„Éó" },
        { en: "K-pop", jp: "K„Éù„ÉÉ„Éó" },
        { en: "indie pop", jp: "„Ç§„É≥„Éá„Ç£„Éº„Éù„ÉÉ„Éó" },
        { en: "folk", jp: "„Éï„Ç©„Éº„ÇØ" },
        { en: "acoustic", jp: "„Ç¢„Ç≥„Éº„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ" },
        { en: "country", jp: "„Ç´„É≥„Éà„É™„Éº" },
        { en: "bossa nova", jp: "„Éú„Çµ„Éé„Éê" },
      ]},
      { label: "„Éí„ÉÉ„Éó„Éõ„ÉÉ„Éó / „É©„ÉÉ„Éó", tags: [
        { en: "hip-hop", jp: "„Éí„ÉÉ„Éó„Éõ„ÉÉ„Éó" },
        { en: "trap", jp: "„Éà„É©„ÉÉ„Éó" },
        { en: "lo-fi hip-hop", jp: "„É≠„Éº„Éï„Ç°„Ç§„Éí„ÉÉ„Éó„Éõ„ÉÉ„Éó" },
        { en: "boom bap", jp: "„Éñ„Éº„É†„Éê„ÉÉ„Éó" },
      ]},
      { label: "„ÉØ„Éº„É´„Éâ / Ê∞ëÊóè", tags: [
        { en: "celtic", jp: "„Ç±„É´„Éà" },
        { en: "Japanese traditional", jp: "ÂíåÈ¢®" },
        { en: "Chinese traditional", jp: "‰∏≠ËèØÈ¢®" },
        { en: "Middle Eastern", jp: "‰∏≠Êù±È¢®" },
        { en: "Latin", jp: "„É©„ÉÜ„É≥" },
        { en: "African", jp: "„Ç¢„Éï„É™„Ç´„É≥" },
        { en: "Nordic", jp: "ÂåóÊ¨ßÈ¢®" },
        { en: "medieval", jp: "‰∏≠‰∏ñÈ¢®" },
      ]},
      { label: "„Ç≤„Éº„É†ÁâπÂåñ„Ç∏„É£„É≥„É´", tags: [
        { en: "JRPG battle theme", jp: "JRPGÊà¶ÈóòÊõ≤" },
        { en: "JRPG exploration theme", jp: "JRPG„Éï„Ç£„Éº„É´„ÉâÊõ≤" },
        { en: "JRPG town theme", jp: "JRPGË°ó„ÅÆÊõ≤" },
        { en: "boss battle theme", jp: "„Éú„ÇπÊà¶" },
        { en: "dungeon theme", jp: "„ÉÄ„É≥„Ç∏„Éß„É≥Êõ≤" },
        { en: "victory fanfare", jp: "ÂãùÂà©„Éï„Ç°„É≥„Éï„Ç°„Éº„É¨" },
        { en: "title screen theme", jp: "„Çø„Ç§„Éà„É´ÁîªÈù¢" },
        { en: "retro video game music", jp: "„É¨„Éà„É≠„Ç≤„Éº„É†Èü≥Ê•Ω" },
      ]},
    ]
  },
  {
    id: "instrument",
    icon: "üéπ",
    title: "Ê•ΩÂô®",
    subcategories: [
      { label: "ÈçµÁõ§", tags: [
        { en: "piano", jp: "„Éî„Ç¢„Éé" },
        { en: "electric piano", jp: "„Ç®„É¨„Éî" },
        { en: "harpsichord", jp: "„ÉÅ„Çß„É≥„Éê„É≠" },
        { en: "organ", jp: "„Ç™„É´„Ç¨„É≥" },
        { en: "synthesizer", jp: "„Ç∑„É≥„Çª„Çµ„Ç§„Ç∂„Éº" },
        { en: "music box", jp: "„Ç™„É´„Ç¥„Éº„É´" },
        { en: "celesta", jp: "„ÉÅ„Çß„É¨„Çπ„Çø" },
        { en: "accordion", jp: "„Ç¢„Ç≥„Éº„Éá„Ç£„Ç™„É≥" },
      ]},
      { label: "Âº¶Ê•ΩÂô®", tags: [
        { en: "strings", jp: "Âº¶Ê•Ω" },
        { en: "string ensemble", jp: "Âº¶Ê•Ω„Ç¢„É≥„Çµ„É≥„Éñ„É´" },
        { en: "violin", jp: "„É¥„Ç°„Ç§„Ç™„É™„É≥" },
        { en: "viola", jp: "„É¥„Ç£„Ç™„É©" },
        { en: "cello", jp: "„ÉÅ„Çß„É≠" },
        { en: "double bass", jp: "„Ç≥„É≥„Éà„É©„Éê„Çπ" },
        { en: "harp", jp: "„Éè„Éº„Éó" },
        { en: "acoustic guitar", jp: "„Ç¢„Ç≥„ÇÆ" },
        { en: "electric guitar", jp: "„Ç®„É¨„Ç≠" },
        { en: "bass guitar", jp: "„Éô„Éº„Çπ" },
        { en: "ukulele", jp: "„Ç¶„ÇØ„É¨„É¨" },
        { en: "banjo", jp: "„Éê„É≥„Ç∏„Éß„Éº" },
        { en: "mandolin", jp: "„Éû„É≥„Éâ„É™„É≥" },
        { en: "koto", jp: "Áê¥" },
        { en: "shamisen", jp: "‰∏âÂë≥Á∑ö" },
        { en: "erhu", jp: "‰∫åËÉ°" },
      ]},
      { label: "ÁÆ°Ê•ΩÂô®", tags: [
        { en: "trumpet", jp: "„Éà„É©„É≥„Éö„ÉÉ„Éà" },
        { en: "French horn", jp: "„Éõ„É´„É≥" },
        { en: "trombone", jp: "„Éà„É≠„É≥„Éú„Éº„É≥" },
        { en: "tuba", jp: "„ÉÅ„É•„Éº„Éê" },
        { en: "brass ensemble", jp: "ÈáëÁÆ°„Ç¢„É≥„Çµ„É≥„Éñ„É´" },
        { en: "flute", jp: "„Éï„É´„Éº„Éà" },
        { en: "piccolo", jp: "„Éî„ÉÉ„Ç≥„É≠" },
        { en: "clarinet", jp: "„ÇØ„É©„É™„Éç„ÉÉ„Éà" },
        { en: "oboe", jp: "„Ç™„Éº„Éú„Ç®" },
        { en: "bassoon", jp: "„Éï„Ç°„Ç¥„ÉÉ„Éà" },
        { en: "saxophone", jp: "„Çµ„ÉÉ„ÇØ„Çπ" },
        { en: "recorder", jp: "„É™„Ç≥„Éº„ÉÄ„Éº" },
        { en: "shakuhachi", jp: "Â∞∫ÂÖ´" },
        { en: "ocarina", jp: "„Ç™„Ç´„É™„Éä" },
        { en: "pan flute", jp: "„Éë„É≥„Éï„É´„Éº„Éà" },
      ]},
      { label: "ÊâìÊ•ΩÂô®", tags: [
        { en: "drums", jp: "„Éâ„É©„É†" },
        { en: "percussion", jp: "„Éë„Éº„Ç´„ÉÉ„Ç∑„Éß„É≥" },
        { en: "timpani", jp: "„ÉÜ„Ç£„É≥„Éë„Éã" },
        { en: "snare drum", jp: "„Çπ„Éç„Ç¢" },
        { en: "taiko", jp: "Â§™Èºì" },
        { en: "xylophone", jp: "Êú®Áê¥" },
        { en: "glockenspiel", jp: "ÈâÑÁê¥" },
        { en: "marimba", jp: "„Éû„É™„É≥„Éê" },
        { en: "vibraphone", jp: "„É¥„Ç£„Éñ„É©„Éï„Ç©„É≥" },
        { en: "tambourine", jp: "„Çø„É≥„Éê„É™„É≥" },
        { en: "triangle", jp: "„Éà„É©„Ç§„Ç¢„É≥„Ç∞„É´" },
        { en: "hand claps", jp: "„Éè„É≥„Éâ„ÇØ„É©„ÉÉ„Éó" },
        { en: "bongo", jp: "„Éú„É≥„Ç¥" },
        { en: "congas", jp: "„Ç≥„É≥„Ç¨" },
      ]},
      { label: "„Åù„ÅÆ‰ªñ", tags: [
        { en: "choir", jp: "ÂêàÂî±" },
        { en: "voice pad", jp: "„Éú„Ç§„Çπ„Éë„ÉÉ„Éâ" },
        { en: "ambient pads", jp: "„Ç¢„É≥„Éì„Ç®„É≥„Éà„Éë„ÉÉ„Éâ" },
        { en: "bell", jp: "„Éô„É´" },
        { en: "wind chimes", jp: "„Ç¶„Ç£„É≥„Éâ„ÉÅ„É£„Ç§„É†" },
        { en: "sound effects", jp: "ÂäπÊûúÈü≥" },
      ]},
    ]
  },
  {
    id: "mood",
    icon: "üí´",
    title: "„É†„Éº„Éâ / ÊÑüÊÉÖ",
    subcategories: [
      { label: "„Éù„Ç∏„ÉÜ„Ç£„Éñ", tags: [
        { en: "cheerful", jp: "ÈôΩÊ∞ó" },
        { en: "joyful", jp: "Âñú„Å≥" },
        { en: "uplifting", jp: "È´òÊèö" },
        { en: "hopeful", jp: "Â∏åÊúõÁöÑ" },
        { en: "triumphant", jp: "ÂãùÂà©" },
        { en: "playful", jp: "„Åä„Å©„Åë„Åü" },
        { en: "whimsical", jp: "„Éï„Ç°„É≥„Çø„Ç∏„Éº" },
        { en: "warm", jp: "Ê∏©„Åã„ÅÑ" },
        { en: "cozy", jp: "„Åæ„Å£„Åü„Çä" },
        { en: "nostalgic", jp: "Êáê„Åã„Åó„ÅÑ" },
        { en: "romantic", jp: "„É≠„Éû„É≥„ÉÅ„ÉÉ„ÇØ" },
        { en: "dreamy", jp: "Â§¢ÊÉ≥ÁöÑ" },
      ]},
      { label: "„Ç∑„É™„Ç¢„Çπ / „ÉÄ„Éº„ÇØ", tags: [
        { en: "dark", jp: "„ÉÄ„Éº„ÇØ" },
        { en: "melancholic", jp: "„É°„É©„É≥„Ç≥„É™„Éº" },
        { en: "sad", jp: "ÊÇ≤„Åó„ÅÑ" },
        { en: "ominous", jp: "‰∏çÁ©è" },
        { en: "menacing", jp: "ËÑÖÂ®Å" },
        { en: "sinister", jp: "‰∏çÊ∞óÂë≥" },
        { en: "mysterious", jp: "„Éü„Çπ„ÉÜ„É™„Ç¢„Çπ" },
        { en: "eerie", jp: "‰∏çÊÄùË≠∞" },
        { en: "haunting", jp: "ÂπΩÁéÑ" },
        { en: "somber", jp: "Âé≥Á≤õ" },
        { en: "tragic", jp: "ÊÇ≤ÂäáÁöÑ" },
      ]},
      { label: "„Ç®„Éç„É´„ÇÆ„Éº", tags: [
        { en: "energetic", jp: "„Ç®„Éç„É´„ÇÆ„ÉÉ„Ç∑„É•" },
        { en: "intense", jp: "ÊøÄ„Åó„ÅÑ" },
        { en: "aggressive", jp: "ÊîªÊíÉÁöÑ" },
        { en: "fierce", jp: "ÁåõÁÉà" },
        { en: "driving", jp: "ÈßÜÂãïÊÑü" },
        { en: "powerful", jp: "ÂäõÂº∑„ÅÑ" },
        { en: "epic", jp: "Â£ÆÂ§ß" },
        { en: "heroic", jp: "Ëã±ÈõÑÁöÑ" },
        { en: "majestic", jp: "ËçòÂé≥" },
        { en: "dramatic", jp: "„Éâ„É©„Éû„ÉÅ„ÉÉ„ÇØ" },
        { en: "cinematic", jp: "Êò†ÁîªÁöÑ" },
      ]},
      { label: "Á©è„ÇÑ„Åã / „É™„É©„ÉÉ„ÇØ„Çπ", tags: [
        { en: "calm", jp: "Á©è„ÇÑ„Åã" },
        { en: "peaceful", jp: "Âπ≥Âíå" },
        { en: "serene", jp: "ÈùôÂØÇ" },
        { en: "gentle", jp: "ÂÑ™„Åó„ÅÑ" },
        { en: "tender", jp: "Êüî„Çâ„Åã„ÅÑ" },
        { en: "soothing", jp: "Áôí„Åó" },
        { en: "relaxing", jp: "„É™„É©„ÉÉ„ÇØ„Çπ" },
        { en: "meditative", jp: "ÁûëÊÉ≥ÁöÑ" },
        { en: "ethereal", jp: "ÂπªÊÉ≥ÁöÑ" },
        { en: "floating", jp: "ÊµÆÈÅäÊÑü" },
        { en: "pastoral", jp: "Áî∞ÂúíÁöÑ" },
      ]},
      { label: "„ÉÜ„É≥„Ç∑„Éß„É≥ / Á∑äÂºµ", tags: [
        { en: "suspenseful", jp: "„Çµ„Çπ„Éö„É≥„Çπ" },
        { en: "tense", jp: "Á∑äÂºµ" },
        { en: "anxious", jp: "‰∏çÂÆâ" },
        { en: "urgent", jp: "ÂàáËø´" },
        { en: "restless", jp: "ËêΩ„Å°ÁùÄ„Åã„Å™„ÅÑ" },
        { en: "building tension", jp: "È´ò„Åæ„ÇãÁ∑äÂºµ" },
      ]},
    ]
  },
  {
    id: "tempo",
    icon: "‚è±",
    title: "„ÉÜ„É≥„Éù / „É™„Ç∫„É†",
    subcategories: [
      { label: "ÈÄüÂ∫¶", tags: [
        { en: "very slow tempo", jp: "Ë∂Ö‰ΩéÈÄü" },
        { en: "slow tempo", jp: "„ÇÜ„Å£„Åè„Çä" },
        { en: "moderate tempo", jp: "‰∏≠ÈÄü" },
        { en: "upbeat", jp: "„Ç¢„ÉÉ„Éó„ÉÜ„É≥„Éù" },
        { en: "fast tempo", jp: "ÈÄü„ÅÑ" },
        { en: "very fast tempo", jp: "Ë∂ÖÈ´òÈÄü" },
      ]},
      { label: "„É™„Ç∫„É†ÊÑü", tags: [
        { en: "steady rhythm", jp: "ÂÆâÂÆö„É™„Ç∫„É†" },
        { en: "syncopated", jp: "„Ç∑„É≥„Ç≥„Éö„Éº„Ç∑„Éß„É≥" },
        { en: "swinging", jp: "„Çπ„Ç¶„Ç£„É≥„Ç∞" },
        { en: "groovy", jp: "„Ç∞„É´„Éº„É¥„Ç£" },
        { en: "marching", jp: "Ë°åÈÄ≤Ë™ø" },
        { en: "waltz", jp: "„ÉØ„É´„ÉÑ" },
        { en: "shuffle", jp: "„Ç∑„É£„ÉÉ„Éï„É´" },
        { en: "free rhythm", jp: "Ëá™Áî±ÊãçÂ≠ê" },
      ]},
    ]
  },
  {
    id: "texture",
    icon: "üé®",
    title: "„ÉÜ„ÇØ„Çπ„ÉÅ„É£ / Â•èÊ≥ï",
    subcategories: [
      { label: "Èü≥„ÅÆ„ÉÜ„ÇØ„Çπ„ÉÅ„É£", tags: [
        { en: "lush", jp: "Ë±ä„Åã" },
        { en: "sparse", jp: "„Åæ„Å∞„Çâ" },
        { en: "layered", jp: "ÈáçÂéö" },
        { en: "minimalist", jp: "„Éü„Éã„Éû„É´" },
        { en: "dense arrangement", jp: "ÂØÜ„Å™„Ç¢„É¨„É≥„Ç∏" },
        { en: "thin texture", jp: "ËñÑ„ÅÑ" },
        { en: "wall of sound", jp: "Èü≥„ÅÆÂ£Å" },
        { en: "spacious", jp: "Â∫É„Åå„Çä" },
      ]},
      { label: "Â•èÊ≥ï / „Éã„É•„Ç¢„É≥„Çπ", tags: [
        { en: "pizzicato strings", jp: "„Éî„ÉÅ„Ç´„Éº„Éà" },
        { en: "staccato", jp: "„Çπ„Çø„ÉÉ„Ç´„Éº„Éà" },
        { en: "legato", jp: "„É¨„Ç¨„Éº„Éà" },
        { en: "tremolo", jp: "„Éà„É¨„É¢„É≠" },
        { en: "arpeggiated", jp: "„Ç¢„É´„Éö„Ç∏„Ç™" },
        { en: "fingerpicking", jp: "„Éï„Ç£„É≥„Ç¨„Éº„Éî„ÉÉ„Ç≠„É≥„Ç∞" },
        { en: "strumming", jp: "„Çπ„Éà„É©„É†" },
        { en: "ostinato", jp: "„Ç™„Çπ„ÉÜ„Ç£„Éä„Éº„Éà" },
        { en: "glissando", jp: "„Ç∞„É™„ÉÉ„Çµ„É≥„Éâ" },
        { en: "vibrato", jp: "„Éì„Éñ„É©„Éº„Éà" },
        { en: "muted", jp: "„Éü„É•„Éº„Éà" },
        { en: "distorted", jp: "Ê≠™„Åø" },
      ]},
      { label: "„ÉÄ„Ç§„Éä„Éü„ÇØ„Çπ", tags: [
        { en: "soft dynamics", jp: "Èùô„Åã„Å´" },
        { en: "loud dynamics", jp: "Â§ßÈü≥Èáè" },
        { en: "dynamic range", jp: "Âº∑Âº±„ÅÆÂπÖ" },
        { en: "crescendo", jp: "„ÇØ„É¨„ÉÉ„Ç∑„Çß„É≥„Éâ" },
        { en: "fade in", jp: "„Éï„Çß„Éº„Éâ„Ç§„É≥" },
        { en: "fade out", jp: "„Éï„Çß„Éº„Éâ„Ç¢„Ç¶„Éà" },
      ]},
    ]
  },
  {
    id: "production",
    icon: "üéõ",
    title: "Èü≥Ë≥™ / „Éó„É≠„ÉÄ„ÇØ„Ç∑„Éß„É≥",
    subcategories: [
      { label: "Èü≥Ë≥™„Ç≠„Éº„ÉØ„Éº„ÉâÔºàÊé®Â•®Ôºâ", tags: [
        { en: "professional studio recording", jp: "„Çπ„Çø„Ç∏„Ç™Èå≤Èü≥" },
        { en: "high-fidelity production", jp: "È´òÈü≥Ë≥™" },
        { en: "polished production", jp: "Ê¥óÁ∑¥„Åï„Çå„ÅüÂà∂‰Ωú" },
        { en: "crystal clear mix", jp: "„ÇØ„É™„Ç¢„Å™„Éü„ÉÉ„ÇØ„Çπ" },
        { en: "warm analog mix", jp: "Ê∏©„Åã„ÅÑ„Ç¢„Éä„É≠„Ç∞" },
      ]},
      { label: "Á©∫Èñì„Éª„Ç®„Éï„Çß„ÇØ„Éà", tags: [
        { en: "warm reverb", jp: "Êöñ„Åã„ÅÑ„É™„Éê„Éº„Éñ" },
        { en: "large hall reverb", jp: "Â§ß„Éõ„Éº„É´„É™„Éê„Éº„Éñ" },
        { en: "intimate room sound", jp: "Ë¶™ÂØÜ„Å™Á©∫Èñì" },
        { en: "wide stereo image", jp: "Â∫É„ÅÑ„Çπ„ÉÜ„É¨„Ç™" },
        { en: "spatial depth", jp: "Á©∫Èñì„ÅÆÂ••Ë°å„Åç" },
        { en: "echo", jp: "„Ç®„Ç≥„Éº" },
        { en: "delay", jp: "„Éá„Ç£„É¨„Ç§" },
      ]},
      { label: "Èü≥Âüü„ÅÆÁâπÂæ¥", tags: [
        { en: "rich low-end", jp: "Ë±ä„Åã„Å™‰ΩéÈü≥" },
        { en: "full bass", jp: "Â§™„ÅÑ„Éô„Éº„Çπ" },
        { en: "rich mid-range", jp: "Ë±ä„Åã„Å™‰∏≠Âüü" },
        { en: "crisp highs", jp: "ÈÆÆÊòé„Å™È´òÈü≥" },
        { en: "smooth highs", jp: "Êªë„Çâ„Åã„Å™È´òÈü≥" },
        { en: "silky smooth highs", jp: "Áµπ„ÅÆ„Çà„ÅÜ„Å™È´òÈü≥" },
        { en: "bright", jp: "Êòé„Çã„ÅÑÈü≥" },
        { en: "dark tone", jp: "Êöó„ÅÑÈü≥Ëâ≤" },
        { en: "mellow tone", jp: "„Åæ„Çç„ÇÑ„Åã„Å™Èü≥" },
        { en: "warm tone", jp: "Êöñ„Åã„ÅÑÈü≥Ëâ≤" },
      ]},
      { label: "„Ç¢„É¨„É≥„Ç∏", tags: [
        { en: "detailed arrangement", jp: "Á∑ªÂØÜ„Å™„Ç¢„É¨„É≥„Ç∏" },
        { en: "complex harmonies", jp: "Ë§áÈõë„Å™„Éè„Éº„É¢„Éã„Éº" },
        { en: "layered instrumentation", jp: "ÈáçÂ±§ÁöÑ„Å™Ê•ΩÂô®Á∑®Êàê" },
        { en: "rich orchestration", jp: "Ë±ä„Åã„Å™ÁÆ°Âº¶Ê•ΩÊ≥ï" },
        { en: "simple arrangement", jp: "„Ç∑„É≥„Éó„É´„Å™Á∑®Êõ≤" },
      ]},
    ]
  },
  {
    id: "vocal",
    icon: "üé§",
    title: "„Éú„Éº„Ç´„É´ÔºàÊ≠å„ÇÇ„ÅÆÁî®Ôºâ",
    subcategories: [
      { label: "Â£∞Ë≥™", tags: [
        { en: "clear male vocalist", jp: "„ÇØ„É™„Ç¢„Å™Áî∑Â£∞" },
        { en: "deep male voice", jp: "‰Ωé„ÅÑÁî∑Â£∞" },
        { en: "clear female vocalist", jp: "„ÇØ„É™„Ç¢„Å™Â•≥Â£∞" },
        { en: "breathy female vocal", jp: "„Éñ„É¨„ÇπÊÑü„ÅÆ„ÅÇ„ÇãÂ•≥Â£∞" },
        { en: "powerful voice", jp: "„Éë„ÉØ„Éï„É´" },
        { en: "soft voice", jp: "„ÇΩ„Éï„Éà" },
        { en: "raspy voice", jp: "„Éè„Çπ„Ç≠„Éº" },
        { en: "high-pitched", jp: "È´òÈü≥" },
        { en: "baritone", jp: "„Éê„É™„Éà„É≥" },
        { en: "soprano", jp: "„ÇΩ„Éó„É©„Éé" },
        { en: "a cappella", jp: "„Ç¢„Ç´„Éö„É©" },
      ]},
    ]
  },
];

// ===== STATE =====
let activeTagsSet = new Set();
let customTags = [];
let openCategoryIds = new Set(['base']);

// ===== RENDER =====
function render() {
  const container = document.getElementById('categories');
  container.innerHTML = '';

  CATEGORIES.forEach(cat => {
    const isOpen = openCategoryIds.has(cat.id);
    const catEl = document.createElement('div');
    catEl.className = `category${isOpen ? ' open' : ''}`;
    catEl.dataset.id = cat.id;

    const activeInCat = countActiveInCategory(cat);

    catEl.innerHTML = `
      <div class="category-header" onclick="toggleCategory('${cat.id}')">
        <span class="category-icon">${cat.icon}</span>
        <span class="category-title">${cat.title}</span>
        <span class="category-count ${activeInCat > 0 ? 'has-active' : ''}">${activeInCat > 0 ? activeInCat : ''}</span>
        <span class="category-chevron">‚ñº</span>
      </div>
      <div class="category-body">
        ${cat.subcategories.map(sub => `
          <div class="subcategory-label">${sub.label}</div>
          <div class="chips">
            ${sub.tags.map(tag => `
              <div class="chip ${activeTagsSet.has(tag.en) ? 'on' : ''}"
                   onclick="toggleTag('${escapeAttr(tag.en)}')"
                   data-en="${escapeAttr(tag.en)}">
                ${tag.en}${tag.jp ? `<span class="jp">${tag.jp}</span>` : ''}
              </div>
            `).join('')}
          </div>
        `).join('')}
        ${cat.id === 'base' ? `
          <div class="subcategory-label">„Ç´„Çπ„Çø„É†„Çø„Ç∞„ÇíËøΩÂä†</div>
          <div class="custom-input-row">
            <input class="custom-input" type="text" placeholder="Ëá™Áî±„Å´„Çø„Ç∞„ÇíÂÖ•Âäõ‚Ä¶" id="customInput"
                   onkeydown="if(event.key==='Enter')addCustomTag()">
            <button class="custom-add-btn" onclick="addCustomTag()">ËøΩÂä†</button>
          </div>
          ${customTags.length > 0 ? `
            <div class="chips" style="margin-top:8px">
              ${customTags.map(t => `
                <div class="chip on" onclick="removeCustomTag('${escapeAttr(t)}')" data-en="${escapeAttr(t)}">
                  ${t} <span style="margin-left:4px;opacity:0.5">‚úï</span>
                </div>
              `).join('')}
            </div>
          ` : ''}
        ` : ''}
      </div>
    `;

    container.appendChild(catEl);
  });

  updateOutput();
}

function escapeAttr(s) {
  return s.replace(/'/g, "\\'").replace(/"/g, '&quot;');
}

function countActiveInCategory(cat) {
  let count = 0;
  cat.subcategories.forEach(sub => {
    sub.tags.forEach(tag => {
      if (activeTagsSet.has(tag.en)) count++;
    });
  });
  return count;
}

// ===== INTERACTIONS =====
function toggleCategory(id) {
  if (openCategoryIds.has(id)) {
    openCategoryIds.delete(id);
  } else {
    openCategoryIds.add(id);
  }
  const el = document.querySelector(`.category[data-id="${id}"]`);
  el.classList.toggle('open');
}

function toggleTag(en) {
  // Unescape
  en = en.replace(/\\'/g, "'");
  if (activeTagsSet.has(en)) {
    activeTagsSet.delete(en);
  } else {
    activeTagsSet.add(en);
  }
  render();
}

function addCustomTag() {
  const input = document.getElementById('customInput');
  const val = input.value.trim();
  if (val && !customTags.includes(val)) {
    customTags.push(val);
    render();
  }
}

function removeCustomTag(tag) {
  tag = tag.replace(/\\'/g, "'");
  customTags = customTags.filter(t => t !== tag);
  render();
}

function clearAll() {
  activeTagsSet.clear();
  customTags = [];
  render();
}

function updateOutput() {
  const outputEl = document.getElementById('outputText');
  const countEl = document.getElementById('wordCount');
  const allTags = [...activeTagsSet, ...customTags];

  if (allTags.length === 0) {
    outputEl.textContent = '„Çø„Ç∞„ÇíÈÅ∏Êäû„Åô„Çã„Å®„Åì„Åì„Å´„Éó„É≠„É≥„Éó„Éà„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô';
    outputEl.className = 'output-text empty';
    countEl.textContent = '';
  } else {
    const prompt = allTags.join(', ');
    outputEl.textContent = prompt;
    outputEl.className = 'output-text';
    countEl.textContent = `${allTags.length} tags ¬∑ ${prompt.length} chars`;
  }

  // Update all category counts
  CATEGORIES.forEach(cat => {
    const el = document.querySelector(`.category[data-id="${cat.id}"] .category-count`);
    if (el) {
      const c = countActiveInCategory(cat);
      el.textContent = c > 0 ? c : '';
      el.className = `category-count ${c > 0 ? 'has-active' : ''}`;
    }
  });
}

function copyPrompt() {
  const allTags = [...activeTagsSet, ...customTags];
  if (allTags.length === 0) return;
  const prompt = allTags.join(', ');

  // Fallback: textarea method (works in sandboxed iframes)
  const textarea = document.createElement('textarea');
  textarea.value = prompt;
  textarea.style.position = 'fixed';
  textarea.style.left = '-9999px';
  textarea.style.top = '-9999px';
  document.body.appendChild(textarea);
  textarea.focus();
  textarea.select();
  try {
    document.execCommand('copy');
    showToast();
  } catch (e) {
    // Last resort: prompt user to copy manually
    window.prompt('„Ç≥„Éî„Éº„Åó„Å¶„Åè„Å†„Åï„ÅÑ:', prompt);
  }
  document.body.removeChild(textarea);
}

function showToast() {
  const toast = document.getElementById('toast');
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 1500);
}

// ===== SEARCH =====
document.getElementById('searchInput').addEventListener('input', function(e) {
  const q = e.target.value.toLowerCase().trim();
  document.querySelectorAll('.chip').forEach(chip => {
    const en = (chip.dataset.en || '').toLowerCase();
    const text = chip.textContent.toLowerCase();
    if (!q || en.includes(q) || text.includes(q)) {
      chip.style.display = '';
    } else {
      chip.style.display = 'none';
    }
  });
  // Auto-open categories with matches
  if (q) {
    document.querySelectorAll('.category').forEach(cat => {
      const hasVisible = cat.querySelectorAll('.chip:not([style*="display: none"])').length > 0;
      if (hasVisible) cat.classList.add('open');
    });
  }
});

// Init
render();
</script>
</body>
</html>
